# Cloud部署





给Cloud安装OnlyOffice









## OCC

【已解决】

- 遇到问题

  用docker的私人云时，登录发现报错：user disable。密码正确也无法登录。

- 解决方式

  ```shell
  docker exec --user www-data 65a293b54724 php occ user:enable jinhua
  ```

  由于在docker环境内，所以要直接用docker exec的方式而不是原版命令。具体格式如下：

  ```shell
  # docker环境内：
  docker exec --user www-data the_containerid php occ your_command
  
  # 非docker环境内（debian/ubuntu）：
  sudo -u www-data php occ your_command
  
  # 查看命令
  docker exec --user www-data the_containerid php occ
  ```

  附文：

  docker 环境内：https://blog.csdn.net/boliang319/article/details/105460597

  非docker环境内：https://www.orgleaf.com/1719.html

  https://www.orgleaf.com/2147.html

  官方解答：https://help.nextcloud.com/t/disabling-user-account/20559/7



#### 发送公告

- 发送公告至指定用户

  ```shell
  docker exec --user www-data the_containerid php occ notification:generate \
  admin "test up to 255"
  -l "testing：正文"
  
  
  docker exec --user www-data 27193831b7b4 php occ notification:generate \
  chenzong "20.09.08 云盘功能升级 V1.3" \
  -l "
  1）（全平台）回收站功能。
  2）（全平台）挂载外部存储。
  3）（仅网页版）文件数据类型分析。
  4）（仅网页版）日历事项提醒。"
  ```

  具体使用方式参照：https://github.com/nextcloud/admin_notifications





自定义脚本

- 输入

  ```sh
  docker exec --user www-data 27193831b7b4 php occ user:list 
  ```



- 经验

  ```sh
  # 读取
   read xxx
   然后用$xxx就可以调用了
   
   
   #!/bin/bash
  cat<<-eof
  1-date 
  2-ls 
  eof
  read options
  case $cmd in
  1)
          echo "测试1成功";;
  2)
          echo "测试2成功";;
  *)
          echo "errpr:please in input (1,2,3,4)";;
  esac
  
  #查找指定文本
  grep，类似于grep ngrokd，在后面加就行。
  
  切记，赋值的时候不能加空格。
  ————以下命令正常赋值入test————
  test=`ls`
  此处的点是小点，不是单引号或双引号！！！！！
  ————以下命令报错command not found————
  test= 'ls'
  
  #取前几个字符
  grep之后用cut，例如我想取前12个字符，我就用：
  your_command | grep [option] | cut -c 1-12
  
  #判断语句if
  用if时，切记有空格！
  判断为假：[[ 3 == 4 ]] 
  判断为真：[[ 3==4 ]] ，所以这就是不管怎样都会真
  
  #cut用法 https://blog.csdn.net/appke846/article/details/80367395
  | cut -d: -f2
  用：做分割，算第二个域。
  
  | cut -c 1-12 
  取第1-12个字符。
  
  #sed用法 https://blog.csdn.net/kangaroo_07/article/details/43733891
  截取中间几行。
  | sed -n '3,3p'
  截取第三行的文本。
  
  #关于单引号
  在单引号内不识别变量，直接在变量外侧多加一组单引号即可。
  '$HOST'  不识别
  ''$HOST''识别
  
  | sed -n '$i,$ip' 不识别
  | sed -n ''$i','$i'p' 识别
  
  
  ```

  



## Onlyoffice 

#### 多人在线协作办公

docker容器启动时间：13s



启动：

```shell
docker run -d \
-p 8888:80 \
-e JWT_ENABLED=true \
-e JWT_SECRET=cocean001 \
--name onlyoffice \
onlyoffice/documentserver
```

端口8888，开启密码，未开启ssl模式



注意：要exec进cloud的容器里修改config/config.php，添加如下命令：

```php
'allow_local_remote_servers' => true,
```

具体参照：https://www.cnblogs.com/leoshi/p/13386083.html

